v5.11

CRITICAL: Live Dashboard - NO WATCHDOG

Date: 2026-01-27
Status: PRODUCTION READY - LIVE REFRESH

Critical Changes from v5.10:
✅ REMOVED watchdog timer completely (caused display freezes)
✅ Zone-based partial refresh (5 zones for efficient updates)
✅ Continuous live updates (20s refresh - NEVER stops)
✅ Location-aware display (shows current context)
✅ Live default dashboard (updates time even when not configured)

Firmware Priorities:
1. NO WATCHDOG TIMER - Removed for continuous display refresh
2. Zone partial refresh - Only update changed zones
3. Location awareness - Display current context
4. Continuous updates - NEVER show static screens

Changes from v5.10:
1. ✅ Removed all watchdog code (#include <esp_task_wdt.h>)
2. ✅ Removed esp_task_wdt_init(), esp_task_wdt_add(), esp_task_wdt_reset()
3. ✅ Implemented 5-zone partial refresh system
4. ✅ Added location tracking and display
5. ✅ Added per-zone change detection (time, location, trams, trains, weather)
6. ✅ Live default dashboard - refreshes every 20s with current time
7. ✅ Parse transit data from server (tram/train arrival times)
8. ✅ Updated version to v5.11 in serial output and HTTP header
9. ✅ Reduced post-refresh delay from 1000ms to 500ms (smoother updates)

Zone Layout (800x480 landscape):
- Zone 1: Top bar (location left, time right) - Y: 0-60
- Zone 2: Trams section (route times) - Y: 150-220
- Zone 3: Trains section (route times) - Y: 150-220
- Zone 4: Large time display - Y: 285-330
- Zone 5: Bottom bar (weather, version) - Y: 420-480

Display Layout (v5.11):
┌─MELBOURNE──────────────────────────12:34─┐
│                                          │
│  TRAMS                  TRAINS           │
│   Route 58 - 2 min       City Loop - 3min│
│   Route 96 - 5 min       Parliament - 7min│
│                                          │
│           TIME: 12:34                    │
│                                          │
│                                          │
│  Weather: Clear          v5.11 Live     │
└──────────────────────────────────────────┘

Default Dashboard (System Not Configured):
- Shows LIVE time (updates every 20s)
- Zone partial refresh (time zones only)
- Clear setup instructions
- NEVER stops refreshing (old behavior: showed once, then froze)

Memory Usage:
- Flash: ~55% (estimated, similar to v5.10)
- Static RAM: ~13% (estimated)
- Runtime Heap: ~220KB free (stable)

Why NO WATCHDOG:
- v5.10 with watchdog caused display to freeze
- Watchdog auto-restart interrupted display operations
- Priority: Continuous visual feedback > automatic recovery
- Solution: Well-tested code + extensive logging instead

Safety Assessment:
✅ Safe for PRODUCTION deployment
✅ Continuous live updates ensure display is never frozen
✅ Zone partial refresh minimizes e-ink artifacts
✅ No watchdog interference with display operations

Upgrade Path:
- From v5.10 → v5.11 (critical - fixes frozen display)
- Flash immediately if experiencing display freezes

---

**Copyright (c) 2026 Angus Bergman**
**Licensed under CC BY-NC 4.0**
**https://creativecommons.org/licenses/by-nc/4.0/**
