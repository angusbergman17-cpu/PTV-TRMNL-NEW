<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PTV-TRMNL Multi-Device Simulator</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #0f172a; color: #f8fafc; min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 20px; }
        header h1 { font-size: 24px; margin-bottom: 8px; }
        header p { color: #94a3b8; font-size: 14px; }
        .device-selector { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
        .device-btn { padding: 10px 16px; background: #334155; border: 2px solid #475569; border-radius: 8px; color: #f8fafc; font-size: 13px; cursor: pointer; transition: all 0.2s; }
        .device-btn:hover { background: #475569; }
        .device-btn.active { background: #6366f1; border-color: #818cf8; }
        .main-layout { display: grid; grid-template-columns: 1fr 350px; gap: 20px; }
        .display-wrapper { background: #1e293b; padding: 20px; border-radius: 12px; border: 2px solid #334155; display: flex; flex-direction: column; align-items: center; }
        .display-info { display: flex; justify-content: space-between; width: 100%; margin-bottom: 15px; font-size: 12px; color: #64748b; }
        .display-info span { background: #334155; padding: 4px 10px; border-radius: 4px; font-family: monospace; }
        #eink-display { background: #f5f5f0; border: 3px solid #1a1a1a; border-radius: 4px; position: relative; overflow: hidden; box-shadow: inset 0 0 30px rgba(0,0,0,0.08); transition: width 0.3s, height 0.3s; }
        .display-text { position: absolute; font-family: "Courier New", monospace; color: #1a1a1a; white-space: nowrap; }
        .font-large { font-size: 18px; font-weight: bold; }
        .font-medium { font-size: 14px; font-weight: bold; }
        .font-small { font-size: 11px; }
        .inverted { background: #1a1a1a; color: #f5f5f0; padding: 6px 12px; }
        .rect-box { position: absolute; border: 2px solid #1a1a1a; }
        .ghosting { opacity: 0.15; }
        .controls { background: #1e293b; padding: 20px; border-radius: 12px; border: 2px solid #334155; max-height: 700px; overflow-y: auto; }
        .controls h2 { font-size: 16px; margin-bottom: 15px; color: #6366f1; }
        .control-section { margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #334155; }
        .control-section:last-child { border-bottom: none; }
        .control-section h3 { font-size: 12px; color: #94a3b8; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px; }
        .control-group { margin-bottom: 10px; }
        .control-group label { display: block; font-size: 11px; color: #64748b; margin-bottom: 3px; }
        .control-group input, .control-group select { width: 100%; padding: 8px 10px; background: #0f172a; border: 1px solid #334155; border-radius: 6px; color: #f8fafc; font-size: 13px; }
        .control-group input:focus, .control-group select:focus { outline: none; border-color: #6366f1; }
        .button-row { display: flex; gap: 8px; margin-top: 15px; }
        button { flex: 1; padding: 10px; background: #6366f1; border: none; border-radius: 6px; color: white; font-size: 13px; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        button:hover { background: #4f46e5; }
        button.secondary { background: #334155; }
        button.secondary:hover { background: #475569; }
        button.warning { background: #f59e0b; }
        button.warning:hover { background: #d97706; }
        .status-bar { margin-top: 20px; background: #1e293b; padding: 12px 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; font-size: 12px; }
        .status-item { display: flex; align-items: center; gap: 6px; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: #22c55e; }
        .status-dot.refreshing { background: #f59e0b; animation: pulse 0.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .refresh-zones { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 10px; }
        .zone { padding: 5px; background: #334155; border-radius: 4px; text-align: center; font-size: 10px; cursor: pointer; }
        .zone.active { background: #6366f1; }
        .zone.dirty { background: #f59e0b; }
        footer { text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid #334155; color: #64748b; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìü PTV-TRMNL Multi-Device Simulator</h1>
            <p>Firmware simulation with Flash ‚Üí Setup ‚Üí Boot ‚Üí Live display</p>
        </header>
        <div class="device-selector" id="device-selector"></div>
        <div class="main-layout">
            <div class="display-wrapper">
                <div class="display-info">
                    <span id="device-name">TRMNL OG</span>
                    <span id="device-res">800√ó480</span>
                    <span id="refresh-mode">FULL</span>
                    <span id="refresh-count">Refresh #0</span>
                </div>
                <div id="eink-display"></div>
            </div>
            <div class="controls">
                <h2>‚öôÔ∏è Simulator Controls</h2>
                <div class="control-section">
                    <h3>üé¨ Device Simulation</h3>
                    <div class="button-row">
                        <button onclick="simulateFlash()" style="background:#f59e0b;">‚ö° Flash Firmware</button>
                    </div>
                    <div class="button-row">
                        <button onclick="simulateSetup()" class="secondary">üìù Setup Wizard</button>
                        <button onclick="simulateBoot()" class="secondary">üîÑ Boot Only</button>
                    </div>
                </div>
                <div class="control-section">
                    <h3>üîÑ Refresh</h3>
                    <div class="button-row">
                        <button onclick="doFullRefresh()">Full Refresh</button>
                        <button class="secondary" onclick="doPartialRefresh()">Partial</button>
                    </div>
                </div>
                <div class="control-section">
                    <h3>üìç Content</h3>
                    <div class="control-group"><label>Location</label><input type="text" id="input-location" value="South Yarra, VIC" oninput="updateDisplay()"></div>
                    <div class="control-group"><label>Time</label><input type="text" id="input-time" value="08:15" oninput="updateDisplay()"></div>
                </div>
            </div>
        </div>
        <div class="status-bar">
            <div class="status-item"><div class="status-dot" id="status-dot"></div><span id="status-text">Ready</span></div>
            <div class="status-item"><span id="device-ppi">--</span></div>
            <div class="status-item"><span>v5.18</span></div>
        </div>
        <footer>PTV-TRMNL Simulator ‚Ä¢ ¬© 2026 Angus Bergman ‚Ä¢ CC BY-NC 4.0</footer>
    </div>
    <script>
        const DEVICES={"trmnl-og":{name:"TRMNL OG",width:800,height:480,ppi:150,orientation:"landscape"}};
        let currentDevice="trmnl-og",refreshCount=0,partialCount=0,ghostElements=[];
        function getScale(d){return Math.min(800/d.width,600/d.height,1);}
        function initDeviceSelector(){const c=document.getElementById("device-selector");c.innerHTML="";Object.entries(DEVICES).forEach(([id,d])=>{const b=document.createElement("button");b.className="device-btn"+(id===currentDevice?" active":"");b.textContent=d.name;b.onclick=()=>selectDevice(id);c.appendChild(b);});}
        function selectDevice(id){currentDevice=id;initDeviceSelector();updateDisplay();updateDeviceInfo();}
        function updateDeviceInfo(){const d=DEVICES[currentDevice];document.getElementById("device-name").textContent=d.name;document.getElementById("device-res").textContent=d.width+"√ó"+d.height;document.getElementById("device-ppi").textContent=d.ppi+" PPI";}
        function updateDisplay(){const d=DEVICES[currentDevice],display=document.getElementById("eink-display"),scale=getScale(d);display.style.width=(d.width*scale)+"px";display.style.height=(d.height*scale)+"px";display.style.background="#f5f5f0";display.innerHTML="";const loc=document.getElementById("input-location").value,time=document.getElementById("input-time").value;addText(display,20,25,"PTV-TRMNL ‚Ä¢ "+loc,"font-large",scale);addText(display,d.width-100,25,time,"font-large",scale);addLine(display,0,55,d.width,55,scale);addText(display,20,80,"Ready - Click Flash Firmware to begin","font-medium",scale);addText(display,20,d.height-30,"Refresh #"+refreshCount,"font-small",scale);}
        function addText(p,x,y,t,f,s,inv=false){const e=document.createElement("div");e.className="display-text "+f+(inv?" inverted":"");e.style.left=(x*s)+"px";e.style.top=(y*s)+"px";e.style.transform="scale("+s+")";e.style.transformOrigin="top left";e.textContent=t;p.appendChild(e);}
        function addLine(p,x1,y1,x2,y2,s){const e=document.createElement("div");e.style.position="absolute";e.style.left=(x1*s)+"px";e.style.top=(y1*s)+"px";e.style.width=((x2-x1)*s)+"px";e.style.height="1px";e.style.background="#1a1a1a";p.appendChild(e);}
        function doFullRefresh(){const d=document.getElementById("eink-display"),dot=document.getElementById("status-dot");dot.classList.add("refreshing");d.style.background="#1a1a1a";setTimeout(()=>{d.style.background="#f5f5f0";refreshCount++;document.getElementById("refresh-count").textContent="Refresh #"+refreshCount;dot.classList.remove("refreshing");updateDisplay();},400);}
        function doPartialRefresh(){refreshCount++;document.getElementById("refresh-count").textContent="Refresh #"+refreshCount;updateDisplay();}
        function simulateFlash(){const d=document.getElementById("eink-display"),dev=DEVICES[currentDevice],s=getScale(dev),dot=document.getElementById("status-dot"),st=document.getElementById("status-text");refreshCount=0;partialCount=0;dot.classList.add("refreshing");d.style.background="#000";d.innerHTML='<div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:monospace;color:#0f0;"><div style="font-size:'+(24*s)+'px;color:#fff;margin-bottom:'+(25*s)+'px;">‚ö° FIRMWARE FLASH</div><div style="width:'+(500*s)+'px;height:'+(25*s)+'px;background:#222;border:2px solid #0f0;border-radius:4px;overflow:hidden;margin-bottom:'+(12*s)+'px;"><div id="flash-progress" style="width:0%;height:100%;background:linear-gradient(90deg,#0a0,#0f0);transition:width 0.3s;"></div></div><div id="flash-text" style="font-size:'+(14*s)+'px;color:#0f0;">Initializing...</div><div style="font-size:'+(10*s)+'px;color:#666;margin-top:'+(15*s)+'px;">DO NOT DISCONNECT DEVICE</div></div>';st.textContent="Flashing firmware...";const steps=[{pct:10,text:"Erasing flash memory...",delay:400},{pct:25,text:"Writing bootloader...",delay:500},{pct:40,text:"Writing firmware_main...",delay:600},{pct:55,text:"Writing firmware_backup...",delay:500},{pct:70,text:"Writing config partition...",delay:400},{pct:85,text:"Verifying checksums...",delay:500},{pct:100,text:"Flash complete!",delay:300}];let i=0;function next(){if(i>=steps.length){setTimeout(()=>simulateSetup(),800);return;}const step=steps[i++];document.getElementById("flash-progress").style.width=step.pct+"%";document.getElementById("flash-text").textContent="Flashing PTV-TRMNL v5.18 ... "+step.pct+"%";st.textContent=step.text;setTimeout(next,step.delay);}next();}
        function simulateSetup(){const d=document.getElementById("eink-display"),dev=DEVICES[currentDevice],s=getScale(dev),st=document.getElementById("status-text");d.style.background="#fff";d.innerHTML='<div style="width:100%;height:100%;padding:'+(30*s)+'px;font-family:-apple-system,sans-serif;color:#000;"><div style="font-size:'+(28*s)+'px;font-weight:800;margin-bottom:'+(8*s)+'px;">üöÉ PTV-TRMNL Setup</div><div style="font-size:'+(12*s)+'px;color:#666;margin-bottom:'+(25*s)+'px;">Configure your smart transit display</div><div style="background:#f5f5f5;border:2px solid #000;padding:'+(15*s)+'px;margin-bottom:'+(15*s)+'px;"><div style="font-size:'+(11*s)+'px;font-weight:700;margin-bottom:'+(8*s)+'px;">üìç HOME ADDRESS</div><div style="background:#fff;border:1px solid #ccc;padding:'+(10*s)+'px;font-size:'+(13*s)+'px;" id="setup-home">Detecting location...</div></div><div style="background:#f5f5f5;border:2px solid #000;padding:'+(15*s)+'px;margin-bottom:'+(15*s)+'px;"><div style="font-size:'+(11*s)+'px;font-weight:700;margin-bottom:'+(8*s)+'px;">üè¢ WORK ADDRESS</div><div style="background:#fff;border:1px solid #ccc;padding:'+(10*s)+'px;font-size:'+(13*s)+'px;" id="setup-work">Waiting...</div></div><div style="background:#f5f5f5;border:2px solid #000;padding:'+(15*s)+'px;"><div style="font-size:'+(11*s)+'px;font-weight:700;margin-bottom:'+(8*s)+'px;">‚òï COFFEE STOP</div><div style="background:#fff;border:1px solid #ccc;padding:'+(10*s)+'px;font-size:'+(13*s)+'px;" id="setup-coffee">Optional</div></div><div style="display:flex;gap:'+(10*s)+'px;margin-top:'+(20*s)+'px;"><div style="flex:1;background:#000;color:#fff;padding:'+(12*s)+'px;text-align:center;font-weight:700;font-size:'+(13*s)+'px;">‚Üê BACK</div><div style="flex:2;background:#6366f1;color:#fff;padding:'+(12*s)+'px;text-align:center;font-weight:700;font-size:'+(13*s)+'px;">CONTINUE ‚Üí</div></div></div>';st.textContent="Setup wizard...";setTimeout(()=>{document.getElementById("setup-home").textContent="68 Cambridge St, Collingwood VIC 3066";st.textContent="Home configured";},600);setTimeout(()=>{document.getElementById("setup-work").textContent="80 Collins St, Melbourne VIC 3000";st.textContent="Work configured";},1200);setTimeout(()=>{document.getElementById("setup-coffee").textContent="Proud Mary, 172 Oxford St";st.textContent="Setup complete!";},1800);setTimeout(()=>simulateBoot(),2500);}
        function simulateBoot(){const d=document.getElementById("eink-display"),dev=DEVICES[currentDevice],s=getScale(dev),dot=document.getElementById("status-dot"),st=document.getElementById("status-text");d.style.background="#000";d.innerHTML='<div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:-apple-system,sans-serif;color:#fff;"><div style="font-size:'+(48*s)+'px;margin-bottom:'+(15*s)+'px;">üöÉ</div><div style="font-size:'+(24*s)+'px;font-weight:800;margin-bottom:'+(8*s)+'px;">PTV-TRMNL</div><div style="font-size:'+(12*s)+'px;color:#888;margin-bottom:'+(30*s)+'px;">Smart Transit Display</div><div style="display:flex;gap:'+(8*s)+'px;margin-bottom:'+(20*s)+'px;"><div style="width:'+(10*s)+'px;height:'+(10*s)+'px;background:#fff;border-radius:50%;animation:bootPulse 1.5s infinite;"></div><div style="width:'+(10*s)+'px;height:'+(10*s)+'px;background:#fff;border-radius:50%;animation:bootPulse 1.5s infinite 0.2s;"></div><div style="width:'+(10*s)+'px;height:'+(10*s)+'px;background:#fff;border-radius:50%;animation:bootPulse 1.5s infinite 0.4s;"></div></div><div id="boot-status" style="font-size:'+(11*s)+'px;color:#666;">Initializing...</div><div style="position:absolute;bottom:'+(25*s)+'px;font-size:'+(10*s)+'px;color:#444;">v5.18 ‚Ä¢ E-Ink '+dev.width+'√ó'+dev.height+'</div></div><style>@keyframes bootPulse{0%,100%{opacity:0.3;transform:scale(0.8);}50%{opacity:1;transform:scale(1);}}</style>';st.textContent="Booting...";const steps=[{text:"Connecting to WiFi...",delay:800},{text:"WiFi connected ‚úì",delay:500},{text:"Connecting to PTV OpenData API...",delay:700},{text:"Fetching real-time departures...",delay:600},{text:"Loading journey data...",delay:500},{text:"Display ready!",delay:400}];let i=0;function next(){if(i>=steps.length){dot.classList.remove("refreshing");st.textContent="Ready";setTimeout(()=>doFullRefresh(),600);return;}const step=steps[i++];document.getElementById("boot-status").textContent=step.text;st.textContent=step.text;setTimeout(next,step.delay);}next();}
        initDeviceSelector();updateDeviceInfo();updateDisplay();
    </script>
</body>
</html>
